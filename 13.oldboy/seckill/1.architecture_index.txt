3个模块:
秒杀接入层:SecProxy
秒杀处理层:SecKill
秒杀后台:SecAdmin
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

秒杀业务图:
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

秒杀架构图:
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

活动状态:
未开始->开始->正常->售罄
未开始->开始->正常->强制售罄售罄
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

秒杀接入层:SecProxy
===========================================================================
功能1:用户系统和抢购系统之间的权限验证

1.用户系统登录成功后,设置两个cookie到客户端和1个reids的secret到服务端
userId:184343
userAuth:xxxxxx  md5(redis中的secret+userId)

2.抢购系统拿到这两个cookie,然后验证用户是否已经在用户系统登录了
userId:184343
userAuth:xxxxxx

用userId获取secret
calcAuth = md5(secret+secret)
if(calcAuth==userAuth){
    登录成功
}else{
    登录失败
}
===========================================================================
功能2:秒级请求限制:
service/antispam.go

type SecLimit struct{
    count int //计数
    curTime int64 //时间
}

//计数:
func (p *SecLimit)Count(nowTime int64) (curCount int){
    if p.curTime != nowTime{//如果传入的时间不是限速记录的当前时间
        p.count=1
        p.curTime= nowTime
    }else{
        p.count++
    }
    return p.count
}

//检查计数:
func (p *SecLimit)Check(nowTime int64) {
    if p.curTime != nowTime{//如果传入的时间不是限速记录的当前时间
        return 0
    }
    return p.count
}

===========================================================================
功能2:http-server返回json:
===========================================================================
功能3:半长连接:
===========================================================================
功能4:抢购开关:
===========================================================================
功能5:ip黑名单:
===========================================================================
功能6:id黑名单:
===========================================================================
功能7:url校验:
===========================================================================
功能8:refer白名单:只有在http refer是下面几个域名的 http请求才会被响应
===========================================================================
功能9:随机拒绝:
===========================================================================
功能10:过载保护:
===========================================================================
功能11:直接对外不用nginx:

///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
秒杀处理层:SecKill
===========================================================================
是否售罄->是否超速->是否已经购买->是否总数超限->是否黑名单->随机抽奖->更新总数->更新速度
===========================================================================
是否超速:
===========================================================================

等级配置:
===========================================================================
速度配置:商品数量1k,活动时间10分钟,/每秒1.6个商品的进行发放
===========================================================================
随机抽奖:
概率等于1,就是先到先得
概率0.5,每次都有50%机会
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////

秒杀后台:SecAdmin
///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////




